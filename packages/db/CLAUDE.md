# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Commands

```bash
pnpm db:generate    # Generate Drizzle migration files
pnpm db:migrate     # Run pending migrations
pnpm db:push        # Push schema directly to DB (dev shortcut)
pnpm db:studio      # Open Drizzle Studio GUI
pnpm build          # Compile to dist/
```

## Architecture

Shared database package using Drizzle ORM + PostgreSQL (`node-postgres` Pool).

- **Entry** (`src/index.ts`): Exports `db` client, `initDB()`/`disconnectDB()`, and re-exports all models/types
- **Models** (`src/models/`): Drizzle table definitions
  - `auth/schema.ts`: Auto-generated by Better Auth CLI (`pnpm auth:generate` from monorepo root) — do not edit manually
  - `schema.ts`, `types.ts`: App-specific models and Zod types (via `drizzle-zod`)
- **Exports** (via `package.json`):
  - `@repo/db` — db client + models + types
  - `@repo/db/schema` — schema only
  - `@repo/db/types` — types only
  - `@repo/db/drizzle-orm` — re-exports from drizzle-orm
- **Config**: `.env` for DB connection (`DB_URL` or individual `DB_HOST`, `DB_PORT`, etc.)

### Adding a Table

1. Create or edit a file in `src/models/`
2. Export the table from `src/models/schema.ts`
3. Run `pnpm db:generate` then `pnpm db:migrate`
