# Database Documentation for LLMs

**Context**: `packages/db`
**Role**: Shared Database Library
**Stack**: PostgreSQL, Drizzle ORM, Zod

## Architecture

- **ORM**: Drizzle ORM (lightweight, type-safe).
- **Schema**: Single source of truth for DB structure and Zod validations.
- **Migrations**: Helper scripts managed via `turborepo`.

## Directory Structure

- `src/models/`: Schema definitions.
  - `auth/`: Generated by Better Auth (do not edit manually unless necessary).
  - `schema.ts`: Exports all schema objects.
- `src/index.ts`: Exports DB client instance (`db`).
- `drizzle.config.ts`: Configuration for Drizzle Kit.

## Development Workflows

### 1. Modifying Database Schema

1.  **Edit Model**: Create or update file in `src/models/`.

    ```typescript
    import { pgTable, text, timestamp, uuid } from "drizzle-orm/pg-core";

    export const myTable = pgTable("my_table", {
    	id: uuid("id").primaryKey().defaultRandom(),
    	name: text("name").notNull(),
    	createdAt: timestamp("created_at").defaultNow(),
    });
    ```

2.  **Export**: Ensure it's exported in `src/models/schema.ts` (or `src/schema.ts`).
3.  **Generate Migration**:
    ```bash
    pnpm db:generate
    ```
4.  **Apply Migration**:
    - **Development**:
      ```bash
      pnpm db:push
      ```
    - **Production**:
      ```bash
      pnpm db:migrate
      ```

### 2. Accessing Database

- Import `db` and schema from `@repo/db`.

```typescript
import { db } from "@repo/db";
import { myTable } from "@repo/db/schema";
import { eq } from "@repo/db/drizzle-orm"; // Helper export

const results = await db.select().from(myTable).where(eq(myTable.id, "123"));
```

### 3. Zod Schemas

- Use `drizzle-zod` to generate Zod schemas from table definitions if needed, or define them manually for API contracts.
